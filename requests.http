# ============================================================================
# HELLO MIRA - Collection de requetes HTTP
# ============================================================================
#
# Utilisation :
#   - VSCode : Installer l'extension "REST Client"
#   - Cliquer sur "Send Request" au-dessus de chaque requete
#   - Ou utiliser curl en ligne de commande
#
# Prerequis :
#   - Docker Compose lance : docker-compose up
#   - Airport API : http://localhost:8001
#   - Flight API : http://localhost:8002
#
# ============================================================================

@airportUrl = http://localhost:8001/api/v1
@flightUrl = http://localhost:8002/api/v1

# ============================================================================
# HEALTH CHECK
# ============================================================================

### Health Check - Airport API
GET {{airportUrl}}/health

### Health Check - Flight API
GET {{flightUrl}}/health

# ============================================================================
# PARTIE 1 - RECHERCHE D'AEROPORTS
# ============================================================================

# ----------------------------------------------------------------------------
# 1. Recherche par code IATA (ex: CDG, JFK, LHR)
# ----------------------------------------------------------------------------

### Aeroport Charles de Gaulle (Paris)
GET {{airportUrl}}/airports/CDG

### Aeroport JFK (New York)
GET {{airportUrl}}/airports/JFK

### Aeroport Heathrow (Londres)
GET {{airportUrl}}/airports/LHR


# ----------------------------------------------------------------------------
# 2. Recherche par nom de lieu (ville, region)
# ----------------------------------------------------------------------------

### Recherche par nom "Paris"
GET {{airportUrl}}/airports/search?name=Paris

### Recherche par nom "London"
GET {{airportUrl}}/airports/search?name=London

### Recherche par nom "Tokyo"
GET {{airportUrl}}/airports/search?name=Tokyo


# ----------------------------------------------------------------------------
# 3. Recherche par coordonnees GPS (proximite)
# ----------------------------------------------------------------------------

### Aeroport le plus proche de Paris (Latitude: 48.8566, Longitude: 2.3522)
GET {{airportUrl}}/airports/nearest?lat=48.8566&lon=2.3522&radius=50

### Aeroport le plus proche de New York (Latitude: 40.7128, Longitude: -74.0060)
GET {{airportUrl}}/airports/nearest?lat=40.7128&lon=-74.0060&radius=50

### Aeroport le plus proche de Tokyo (Latitude: 35.6762, Longitude: 139.6503)
GET {{airportUrl}}/airports/nearest?lat=35.6762&lon=139.6503&radius=50


# ----------------------------------------------------------------------------
# 4. Recherche par adresse (geocodage automatique)
# ----------------------------------------------------------------------------

### Aeroport le plus proche de "Lille, France"
GET {{baseUrl}}/airports/nearest-by-address?address=Lille,France&country_code=FR

### Aeroport le plus proche de "10 rue de Rivoli, Paris"
GET {{baseUrl}}/airports/nearest-by-address?address=10 rue de Rivoli, Paris&country_code=FR

### Aeroport le plus proche de "Tour Eiffel, Paris"
GET {{airportUrl}}/airports/nearest?address=Tour Eiffel, Paris&radius=50

### Aeroport le plus proche de "Times Square, New York"
GET {{airportUrl}}/airports/nearest?address=Times Square, New York&radius=100

### Aeroport le plus proche de "Big Ben, London"
GET {{airportUrl}}/airports/nearest?address=Big Ben, London&radius=50


# ============================================================================
# PARTIE 2 - VOLS AU DEPART ET A L'ARRIVEE
# ============================================================================

# ----------------------------------------------------------------------------
# 1. Vols au depart d'un aeroport
# ----------------------------------------------------------------------------

### Vols au depart de CDG (limite 10)
GET {{airportUrl}}/airports/CDG/departures?limit=10

### Vols au depart de JFK (limite 20)
GET {{airportUrl}}/airports/JFK/departures?limit=20

### Vols au depart de LHR avec pagination (offset 10, limite 5)
GET {{airportUrl}}/airports/LHR/departures?limit=5&offset=10


# ----------------------------------------------------------------------------
# 2. Vols a l'arrivee d'un aeroport
# ----------------------------------------------------------------------------

### Vols a l'arrivee de CDG (limite 10)
GET {{airportUrl}}/airports/CDG/arrivals?limit=10

### Vols a l'arrivee de JFK (limite 20)
GET {{airportUrl}}/airports/JFK/arrivals?limit=20

### Vols a l'arrivee de LHR avec pagination (offset 10, limite 5)
GET {{airportUrl}}/airports/LHR/arrivals?limit=5&offset=10


# ============================================================================
# TESTS DE CAS LIMITES
# ============================================================================

### Code IATA inexistant (doit retourner 404)
GET {{airportUrl}}/airports/XXX

### Coordonnees GPS invalides (doit retourner 400)
GET {{airportUrl}}/airports/nearest?lat=200&lon=300

### Adresse introuvable (doit retourner 404)
GET {{airportUrl}}/airports/nearest?address=adresse_inexistante_12345

### Pagination limite excessive (doit etre capee a 100)
GET {{airportUrl}}/airports/CDG/departures?limit=1000


# ============================================================================
# PARTIE 2 - SUIVI INDIVIDUEL DE VOLS
# ============================================================================

# ----------------------------------------------------------------------------
# 1. Statut en temps reel d'un vol
# ----------------------------------------------------------------------------

### Vol AF282 (Paris CDG -> Tokyo HND)
GET {{flightUrl}}/flights/AF282

### Vol MU6241 (vol chinois)
GET {{flightUrl}}/flights/MU6241

### Vol BA117 (British Airways)
GET {{flightUrl}}/flights/BA117


# ----------------------------------------------------------------------------
# 2. Historique d'un vol sur une periode
# ----------------------------------------------------------------------------

### Historique AF282 (2 jours)
GET {{flightUrl}}/flights/AF282/history?start_date=2025-11-21&end_date=2025-11-22

### Historique MU6241 (3 jours)
GET {{flightUrl}}/flights/MU6241/history?start_date=2025-11-20&end_date=2025-11-22


# ----------------------------------------------------------------------------
# 3. Statistiques agregeees sur une periode
# ----------------------------------------------------------------------------

### Statistiques AF282 (ponctualite, retards)
GET {{flightUrl}}/flights/AF282/statistics?start_date=2025-11-21&end_date=2025-11-22

### Statistiques MU6241
GET {{flightUrl}}/flights/MU6241/statistics?start_date=2025-11-20&end_date=2025-11-22


# ----------------------------------------------------------------------------
# 4. Cas limites
# ----------------------------------------------------------------------------

### Vol inexistant (doit retourner 404)
GET {{flightUrl}}/flights/XXXXX

### Dates invalides (doit retourner 400)
GET {{flightUrl}}/flights/AF282/history?start_date=2025-13-32&end_date=2025-11-22

### Periode inversee (doit retourner 400)
GET {{flightUrl}}/flights/AF282/history?start_date=2025-11-22&end_date=2025-11-21


# ============================================================================
# TESTS DE CACHE (relancer 2 fois pour voir cache hit)
# ============================================================================

### 1ere requete - Cache MISS (appel API externe)
GET {{airportUrl}}/airports/CDG

### 2eme requete - Cache HIT (depuis MongoDB, plus rapide)
GET {{airportUrl}}/airports/CDG


# ============================================================================
# DOCUMENTATION API
# ============================================================================

### Swagger UI (interface interactive)
# Ouvrir dans le navigateur : http://localhost:8001/docs

### ReDoc (documentation alternative)
# Ouvrir dans le navigateur : http://localhost:8001/redoc

### Schema OpenAPI JSON
# GET http://localhost:8001/openapi.json


# ============================================================================
# NOTES
# ============================================================================
#
# Microservice Airport (port 8001) :
#   GET  /api/v1/health                              - Health check
#   GET  /api/v1/airports/{iata}                     - Recherche par code IATA
#   GET  /api/v1/airports/search?name={name}         - Recherche par nom
#   GET  /api/v1/airports/nearest?lat={lat}&lon={lon} - Recherche par GPS
#   GET  /api/v1/airports/nearest?address={address}  - Recherche par adresse
#   GET  /api/v1/airports/{iata}/departures          - Vols au depart
#   GET  /api/v1/airports/{iata}/arrivals            - Vols a l'arrivee
#
# Microservice Flight (port 8002) :
#   GET  /api/v1/health                              - Health check
#   GET  /api/v1/flights/{iata}                      - Statut temps reel d'un vol
#   GET  /api/v1/flights/{iata}/history              - Historique sur une periode
#   GET  /api/v1/flights/{iata}/statistics           - Statistiques agregeees
#
# Microservice Assistant (port 8003) :
#   POST /api/v1/assistant/interpret                - Interprete l'intention
#   POST /api/v1/assistant/answer                   - Reponse complete en langage naturel
#
# Optimisations :
#   - Cache MongoDB avec TTL de 300s (5 minutes)
#   - Historique construit progressivement (chaque appel stocke ~2 jours)
#   - Statistiques : seuil retard > 15 min (standard aviation)
#   - LangGraph StateGraph pour orchestration multi-agents
#   - Mistral AI function calling pour detection d'intention
#
# ============================================================================


# ============================================================================
# PARTIE 4 - ASSISTANT IA CONVERSATIONNEL
# ============================================================================

@assistantUrl = http://localhost:8003/api/v1

# ----------------------------------------------------------------------------
# 1. Interpretation d'intention (sans execution)
# ----------------------------------------------------------------------------

### Interprete : Statut d'un vol
POST {{assistantUrl}}/assistant/interpret
Content-Type: application/json

{
  "prompt": "Je suis sur le vol AF282, à quelle heure vais-je arriver ?"
}

### Interprete : Recherche d'aeroport
POST {{assistantUrl}}/assistant/interpret
Content-Type: application/json

{
  "prompt": "Trouve-moi l'aéroport le plus proche de Lille"
}

### Interprete : Vols au depart
POST {{assistantUrl}}/assistant/interpret
Content-Type: application/json

{
  "prompt": "Quels vols partent de CDG cet après-midi ?"
}


# ----------------------------------------------------------------------------
# 2. Reponse complete en langage naturel (orchestration complete)
# ----------------------------------------------------------------------------

### Exemple du cahier des charges 1 : Statut d'un vol
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Je suis sur le vol AV15, à quelle heure vais-je arriver ?"
}

### Exemple du cahier des charges 2 : Vols au depart
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Quels vols partent de CDG cet après-midi ?"
}

### Exemple du cahier des charges 3 : Aeroport le plus proche
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Trouve-moi l'aéroport le plus proche de Lille"
}

### Statut du vol AF282
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Je suis sur le vol AF282, à quelle heure j'arrive ?"
}

### Recherche d'aeroport par nom
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Cherche des aéroports à Paris"
}

### Statistiques d'un vol
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Donne-moi les statistiques de ponctualité du vol BA117 sur les 30 derniers jours"
}

### Vols a l'arrivee
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Quels vols arrivent à JFK dans les prochaines heures ?"
}

### Informations sur un aeroport
POST {{assistantUrl}}/assistant/answer
Content-Type: application/json

{
  "prompt": "Donne-moi des informations sur l'aéroport CDG"
}


# ============================================================================
